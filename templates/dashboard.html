<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Haunt Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
    <script>
        async function playSound(deviceId, soundFile) {
            const formData = new FormData();
            formData.append("device_id", deviceId);
            formData.append("sound_file", soundFile);

            const statusElem = document.getElementById("status");
            statusElem.textContent = `üîÑ Sending "${soundFile}" to ${deviceId}...`;

            try {
                const res = await fetch("/api/play", {
                    method: "POST",
                    body: formData
                });

                if (res.ok) {
                    const msg = await res.text();
                    statusElem.textContent = `‚úÖ ${msg}`;
                } else {
                    const err = await res.text();
                    statusElem.textContent = `‚ùå Error ${res.status}: ${err}`;
                }
            } catch (err) {
                statusElem.textContent = `‚ùå Request failed: ${err}`;
            }
        }
    </script>
</head>
<body class="bg-dark text-light">
    <div class="container mt-4">
        <h1 class="mb-4">üéÉ Haunt Control Dashboard</h1>

        <div id="status" class="alert alert-info">Ready.</div>

        {% if sound_map %}
            {% for device_id, sounds in sound_map.items() %}
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <strong>Device:</strong> {{ device_id }}
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for sound in sounds %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ sound }}</span>
                                <button class="btn btn-primary btn-sm" onclick="playSound('{{ device_id }}', '{{ sound }}')">
                                    ‚ñ∂Ô∏è Play
                                </button>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endfor %}
        {% else %}
            <p>No devices or sounds registered.</p>
        {% endif %}
    </div>
</body>
</html>
